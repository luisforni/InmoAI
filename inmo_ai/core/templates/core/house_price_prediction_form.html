<div class="row mt-3 mb-5">
    <div class="col-md-12">
        <div class="mt-3">
            <h4>Predicción del Ingreso Medio</h4>
            <p>Por defectos se cargan los valores medios de cada parámetro.</p>
        </div>
        <form id="income-prediction-form">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-3">
                    <div class="form-floating">
                        <input type="number" class="form-control" id="population" name="population" value="{{ averages.avg_population }}" required>
                        <label for="population">Población</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating">
                        <input type="number" class="form-control" id="households" name="households" value="{{ averages.avg_households }}" required>
                        <label for="households">Hogares</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating">
                        <input type="number" class="form-control" id="total_rooms" name="total_rooms" value="{{ averages.avg_total_rooms }}" required>
                        <label for="total_rooms">Total de habitaciones</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating">
                        <input type="number" class="form-control" id="total_bedrooms" name="total_bedrooms" value="{{ averages.avg_total_bedrooms }}" required>
                        <label for="total_bedrooms">Total de dormitorios</label>
                    </div>
                </div>
            </div>
            <button type="button" class="btn btn-danger btn-block mt-3" onclick="submitIncomePredictionForm()">Predecir Ingreso Medio</button>
        </form>
        <div id="income-prediction-message" style="display:none;">
            Predicción del ingreso medio: <strong id="income-prediction-value"></strong>
        </div>
    </div>
</div>


<script>
    function submitIncomePredictionForm() {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        const data = {
            population: document.getElementById('population').value,
            households: document.getElementById('households').value,
            total_rooms: document.getElementById('total_rooms').value,
            total_bedrooms: document.getElementById('total_bedrooms').value
        };

        // Realiza la solicitud POST para la predicción del ingreso medio
        fetch("{% url 'income_prediction' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            if (data.prediction) {
                document.getElementById("income-prediction-value").textContent = data.prediction;
                document.getElementById("income-prediction-message").style.display = 'block';
            } else {
                alert("Error: " + data.message);
            }
        })
        .catch(error => {
            console.error("Error en la solicitud:", error);
            alert("Hubo un problema con la solicitud.");
        });
    }
</script>
